---
layout: post
title: FOSUserBundle用户登陆表单存在安全问题
meta_keywords: Symfony, 安全, 用户
meta_description: FOSUserBundle存在跟密码长度有关的安全性问题
category: news
active_nav: news
---

[原文地址](http://symfony.com/blog/cve-2013-5750-security-issue-in-fosuserbundle-login-form)

Django最近发布了一个[新的版本](https://www.djangoproject.com/weblog/2013/sep/15/security/)，
用来应对一种新的DOS攻击方式，攻击者会提交非常长的密码以达到消耗目标计算资源的目的。

众所周知保存密码的最佳实践之一就是将密码加密保存。
Symfony的[encoder](http://symfony.com/doc/current/book/security.html#encoding-the-user-s-password)
就是专门负责加密和校验密码的。

对于大部分内置加密算法而言，随着密码长度的增加，加密所需要的时间也会显著增加。
如果攻击者不断的提交密码，Symfony就会消耗更多资源去加密。

并不是所有的加密算法都有这个问题，但一些常被推荐使用的却很容易中招，
下面列出一些加密算法加密一个10万个字符的字符串时所需要的时间：

算法                         |encodePassword()
-----------------------------|----------------
BCrypt(cost<14)              |<1s
BCrypt(cost 18)              |20s
BCrypt(cost 20)              |78s
Pbkdf2* (1,000 it)           |6s
Plaintext*                   |<1s
MessageDigest* (5,000 it)|30s|30s
Pbkdf2 (10,000 it)           |55s

如你所见，Pbkdf2算法使用10000次反复加密的方式，花了几乎快一分钟的时间（iOS 7默认反复加密次数）

Symfony没有提供默认的登陆表单，不过[FOSUserBundle](https://github.com/FriendsOfSymfony/FOSUserBundle)
有提供。FOSUserBundle因为没有最长密码长度提交限制，所以容易中招。
新版本([1.3.3](https://github.com/FriendsOfSymfony/FOSUserBundle/compare/v1.3.2...v1.3.3))
已经修复了这个问题（默认将密码限制在4096个字符）。如果您的网站没有使用FOSUserBundle，也需要验证密码的最大长度。

为了提供更好的保护，
Symfony的2.4版本将在`encodePassword()`和`isPasswordValid()`[强行限制](https://github.com/symfony/symfony/pull/9100)
密码长度在4096个字符之内（如果你使用了自己定制的加密方式，你需要自己调用`$this->checkPasswordLength($raw)`）。
当然，您也得在密码验证设置中添加将密码长度设置为同样的长度或者更短。

我们也将更新文档[关于密码以及加密的最佳实践](https://github.com/symfony/symfony-docs/issues/3003)
